---
import CowSay from "@components/blog/CowSay.astro";
import Layout from "@layouts/Layout.astro";
import { type CollectionEntry, getCollection } from "astro:content";
export const getStaticPaths = async () => {
  const posts = await getCollection("posts");
  return posts.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
};

const { entry } = Astro.props as { entry: CollectionEntry<"posts"> };
const { Content, headings } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.summary}>
  <h1 class="gradient-text">{entry.data.title}</h1>
  <div class="wrapper">
    <div class="toc-wrapper">
      <nav aria-labelledby="on-this-page" class="toc">
        <h2 id="on-this-page">On This Page</h2>
        <ul>
          {
            headings.map((h) => (
              <li>
                <a href={`#${h.slug}`}>{h.text}</a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
    <div>
      <CowSay text={entry.data.cowsay} />
      <Content />
    </div>
  </div>
</Layout>

<style>
  div.wrapper {
    display: flex;
    flex-direction: column;
    gap: var(--6);

    :first-child {
      min-width: min-content;
    }

    :last-child {
      min-width: 0;
    }
  }

  @media (min-width: 1200px) {
    div.wrapper {
      flex-direction: row;
    }
  }

  div.toc-wrapper {
    nav {
      position: sticky;
      top: var(--4);

      h2 {
        margin-top: 0;
      }

      ul {
        display: flex;
        flex-direction: column;
        gap: var(--small);
        padding-left: 0;
        width: 100%;

        li {
          width: 100%;
          border-left: dashed 2px var(--accent);
          padding-left: var(--small);
          list-style-type: none;
          font-size: var(--2);
          white-space: nowrap;

          a {
            text-decoration: none;
          }

          &.current,
          &:hover {
            border-left-style: solid;
          }
        }
      }
    }
  }
</style>

<style is:global>
  pre {
    padding: var(--small);
    border-radius: 5px;
    box-sizing: border-box;
    background-color: var(--background-950) !important;
    box-shadow: inset color(from var(--background-100) srgb r g b / 0.2) 0 0 6px;
    overflow-x: auto;
    width: 100%;
  }

  img {
    box-sizing: border-box;
    border-radius: 5px;
    max-width: 100%;
    height: auto;
    box-shadow: color(from var(--accent) srgb r g b / 0.2) 0 0 6px;
  }
</style>
